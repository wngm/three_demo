var U=Object.defineProperty;var J=(n,e,t)=>e in n?U(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var k=(n,e,t)=>(J(n,typeof e!="symbol"?e+"":e,t),t);import{E as V,V as d,b as Z,T as Q,d as v,B as $,e as y,G as ee,R as j,C as te,S as se,f as oe,g as ne,P as ie,W as re,h as q,A as ae,i as ce,D as he,j as le,k as de,l as me,m as ue,p as fe,q as pe,r as I,n as we,o as ge,c as ye}from"./index-431561ab.js";const x=new V(0,0,0,"YXZ"),b=new d,ve={type:"change"},ke={type:"lock"},xe={type:"unlock"},F=Math.PI/2;class be extends Z{constructor(e,t){super(),this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1;const s=this;function o(i){if(s.isLocked===!1)return;const l=i.movementX||i.mozMovementX||i.webkitMovementX||0,m=i.movementY||i.mozMovementY||i.webkitMovementY||0;x.setFromQuaternion(e.quaternion),x.y-=l*.002*s.pointerSpeed,x.x-=m*.002*s.pointerSpeed,x.x=Math.max(F-s.maxPolarAngle,Math.min(F-s.minPolarAngle,x.x)),e.quaternion.setFromEuler(x),s.dispatchEvent(ve)}function r(){s.domElement.ownerDocument.pointerLockElement===s.domElement?(s.dispatchEvent(ke),s.isLocked=!0):(s.dispatchEvent(xe),s.isLocked=!1)}function c(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){s.domElement.ownerDocument.addEventListener("mousemove",o),s.domElement.ownerDocument.addEventListener("pointerlockchange",r),s.domElement.ownerDocument.addEventListener("pointerlockerror",c)},this.disconnect=function(){s.domElement.ownerDocument.removeEventListener("mousemove",o),s.domElement.ownerDocument.removeEventListener("pointerlockchange",r),s.domElement.ownerDocument.removeEventListener("pointerlockerror",c)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){const i=new d(0,0,-1);return function(l){return l.copy(i).applyQuaternion(e.quaternion)}}(),this.moveForward=function(i){b.setFromMatrixColumn(e.matrix,0),b.crossVectors(e.up,b),e.position.addScaledVector(b,i)},this.moveRight=function(i){b.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(b,i)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){s.domElement.ownerDocument.exitPointerLock()},this.connect()}}const Me=""+new URL("blocks-a4d47609.png",import.meta.url).href,E=new Q().load(Me);E.repeat.set(.0625,.0625);function P(n,e){let t=E.clone();return t.offset.set(n/16,e/16),t}let Y=E.clone(),K=E.clone(),T=E.clone();Y.offset.set(0,15/16);K.offset.set(2/16,15/16);T.offset.set(1/16,15/16);let H=E.clone();H.offset.set(4/16,15/16);const Ee=new v({map:Y}),N=new v({map:K}),_=new v({map:T}),Le=new v({map:H}),W=new v({map:P(1,13)}),C=new v({map:P(0,13)}),_e=new v({map:P(2,13)}),L=new $(1,1,1),Ce=new y(L,N),De=new y(L,[_,_,Ee,N,_,_]),Pe=new y(L,Le),Be=new y(L,[C,C,W,W,C,C]),Ae=new y(L,_e);class M{constructor(e){const{position:t}=e;this.mesh=Ce.clone(),t&&this.mesh.position.set(t.x,t.y,t.z)}}class Se extends M{constructor(e){super(e);const{position:t}=e;this.mesh=De.clone(),t&&this.mesh.position.set(t.x,t.y,t.z)}}class ze extends M{constructor(e){const{position:t}=e;super(e),this.mesh=Pe.clone(),t&&this.mesh.position.set(t.x,t.y,t.z)}}class Ge extends M{constructor(e){const{position:t}=e;super(e),this.mesh=Ae.clone(),t&&this.mesh.position.set(t.x,t.y,t.z)}}class Re extends M{constructor(e){const{position:t}=e;super(e),this.mesh=Be.clone(),t&&this.mesh.position.set(t.x,t.y,t.z)}}const Oe=Object.freeze(Object.defineProperty({__proto__:null,default:M,BaseBox:M,GrassBox:Se,CoalBox:ze,StoneBox:Ge,FireBox:Re},Symbol.toStringTag,{value:"Module"})),a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let n=0;n<256;n++)a[256+n]=a[n];function D(n){return n*n*n*(n*(n*6-15)+10)}function g(n,e,t){return e+n*(t-e)}function p(n,e,t,s){const o=n&15,r=o<8?e:t,c=o<4?t:o==12||o==14?e:s;return(o&1?-r:r)+(o&2?-c:c)}class je{noise(e,t,s){const o=Math.floor(e),r=Math.floor(t),c=Math.floor(s),i=o&255,l=r&255,m=c&255;e-=o,t-=r,s-=c;const u=e-1,w=t-1,h=s-1,f=D(e),B=D(t),X=D(s),A=a[i]+l,S=a[A]+m,z=a[A+1]+m,G=a[i+1]+l,R=a[G]+m,O=a[G+1]+m;return g(X,g(B,g(f,p(a[S],e,t,s),p(a[R],u,t,s)),g(f,p(a[z],e,w,s),p(a[O],u,w,s))),g(B,g(f,p(a[S+1],e,t,h),p(a[R+1],u,t,h)),g(f,p(a[z+1],e,w,h),p(a[O+1],u,w,h))))}}class qe{constructor(){k(this,"get",(e,t,s)=>this.noise.noise(e,t,s));this.noise=new je,this.seed=1.75*.6,this.quality=10,this.scale=10,this.seedGrass=1.75,this.qualityGrass=10,this.scaleGrass=10,this.seedCoal=1.75*.8,this.qualityCoal=10,this.scaleCoal=10}}class Ie{constructor(){k(this,"blocks",[]);this.width=100,this.height=100,this.fixY=0,this.startY=-5}createGround(){const e=new qe;let t=[];for(let s=0;s<this.width;s++)for(let o=0;o<this.height;o++){let r=e.get(s/e.quality,o/e.quality,e.seed)*e.scale,c=e.get(s/e.qualityGrass,o/e.qualityGrass,e.seedGrass)*e.scaleGrass,i=e.get(s/e.qualityCoal,o/e.qualityCoal,e.seedCoal)*e.scaleCoal,l=~~r+this.fixY,m=~~c+this.fixY,u=~~i+this.fixY,w=Math.max(l,m,u);for(let h=this.startY;h<w;h++)h>l?h<u?t.push({x:s,y:h,z:o,type:"CoalBox"}):t.push({x:s,y:h,z:o,type:"GrassBox"}):t.push({x:s,y:h,z:o,type:"BaseBox"})}return t}}new ee;class Fe{constructor(e){k(this,"onWindowResize",()=>{const e=window.innerWidth,t=window.innerHeight;this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()});k(this,"onKeyDown",e=>{const t=this._controls;switch(e.code){case"ArrowUp":case"KeyW":t.moveForward=!0;break;case"ArrowDown":case"KeyS":t.moveBackward=!0;break;case"ArrowLeft":case"KeyA":t.moveLeft=!0;break;case"ArrowRight":case"KeyD":t.moveRight=!0;break;case"Space":t.canJump===!0&&(this.velocity.y+=50),t.canJump=!1;break}});k(this,"onKeyUp",e=>{const t=this._controls;switch(e.code){case"ArrowUp":case"KeyW":t.moveForward=!1;break;case"ArrowDown":case"KeyS":t.moveBackward=!1;break;case"ArrowLeft":case"KeyA":t.moveLeft=!1;break;case"ArrowRight":case"KeyD":t.moveRight=!1;break}});this.parentDom=e.dom,this.dom=e.dom,this.blocks=[],this._controls={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,canJump:!1},this.raycaster=new j(new d,new d(0,-1,0),0,10),this.raycaster2=new j(new d,new d(0,-1,0),0,10),this.velocity=new d,this.direction=new d,this.vertex=new d,this.init()}init(){this.clock=new te,this.scene=new se,this.setCamera(),this.setRenderer(),this.setGround(),this.setLight(),this.composer=new oe(this.renderer),this.setController(),this.render(),this.animate(),this.onEvent()}onEvent(){window.addEventListener("resize",this.onWindowResize),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.dom.addEventListener("click",()=>{this.controls.lock()}),this.controls.addEventListener("lock",function(){}),this.controls.addEventListener("unlock",function(){})}addCameraHelper(){const e=new ne(this.camera);this.scene.add(e)}setCamera(){this.camera=new ie(75,this.parentDom.offsetWidth/this.parentDom.offsetHeight,.1,1e3),this.camera.position.z=10,this.camera.position.x=10,this.camera.position.y=10}setRenderer(){this.renderer=new re({}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=void 0,this.renderer.setSize(this.parentDom.offsetWidth,this.parentDom.offsetHeight),this.parentDom.appendChild(this.renderer.domElement),this.renderer.domElement.id="test"}setGround(){new Ie().createGround().forEach(s=>{let o=new Oe[s.type]({position:s}).mesh;this.blocks.push(o),this.scene.add(o)})}setLight(){this.scene.background=new q(8900331),this.ambientLight=new ae(15790320),new ce(16777215,30,100).position.set(50,50,50);const s=new he("#ffffff",1);s.position.set(-40,60,-10),s.shadow.camera.near=20,s.shadow.camera.far=200,s.shadow.camera.left=-50,s.shadow.camera.right=50,s.shadow.camera.top=50,s.shadow.camera.bottom=-50,s.shadow.mapSize.height=1024,s.shadow.mapSize.width=1024,this.scene.add(s);var o=new le(16711680,3);o.position.set(0,1,0),o.rotation.set(-Math.PI/2,0,0),o.width=4,o.height=9.9,this.scene.add(this.ambientLight)}createParticles(){for(var e=new(void 0),t=new(void 0)({size:4,vertexColors:!0,color:16777215}),s=-5;s<5;s++)for(var o=-5;o<5;o++){var r=new d(s*10,o*10,0);e.vertices.push(r),e.colors.push(new q(Math.random()*65535))}var c=new(void 0)(e,t);this.scene.add(c)}setController(){this.controls=new be(this.camera,document.body),this.scene.add(this.controls.getObject())}render(){this.renderer.render(this.scene,this.camera)}animate(){requestAnimationFrame(this.animate.bind(this));const e=this.clock.getDelta(),t=10,s=this.controls;this.raycaster;const o=this.velocity,r=this.direction,{moveForward:c,moveBackward:i,moveLeft:l,moveRight:m,canJump:u}=this._controls;if(s.isLocked===!0){const h=this.getIntersections().length>0;o.x-=o.x*10*e,o.z-=o.z*10*e,o.y-=9.8*20*e,r.z=Number(c)-Number(i),r.x=Number(m)-Number(l),r.normalize(),(c||i)&&(o.z-=r.z*t*e),(l||m)&&(o.x-=r.x*t*e),h===!0&&(o.y=Math.max(0,o.y),this._controls.canJump=!0);let f=new d().clone(o);f.y=0,f.normalize(),this.getIntersectionsMove(f),s.moveRight(-o.x*e),s.moveForward(-o.z*e),s.getObject().position.y+=o.y*e,s.getObject().position.y<-500&&(s.getObject().position.x=10,s.getObject().position.z=10,s.getObject().position.y=10)}this.render()}getIntersectionsMove(e){let t=new d;this.controls.getDirection(t);const s=4;return this.raycaster2.ray.origin.copy(this.controls.getObject().position),this.raycaster2.ray.direction.copy(e),this.raycaster.ray.origin.y-=s,this.raycaster.intersectObjects(this.blocks,!1)}getIntersections(e){return this.raycaster.ray.origin.copy(e||this.controls.getObject().position),this.raycaster.ray.origin.y-=-4,this.raycaster.intersectObjects(this.blocks,!1)}addModel(){const e=new y(new de(90,90,10,10),new me({color:10530223,shininess:150}));e.rotation.x=-Math.PI/2,e.receiveShadow=!0,e.position.set(0,-10,0);let t=new y(new ue(10,100,0,2*Math.PI),new fe({color:16711680,side:pe}));t.position.set(0,20,0),this.scene.add(e),this.scene.add(t)}}const Ke={__name:"World",setup(n){const e=I(null);return I(2),we(()=>{new Fe({dom:e.value})}),(t,s)=>(ge(),ye("div",{class:"three",ref_key:"box",ref:e},null,512))}};export{Ke as default};
